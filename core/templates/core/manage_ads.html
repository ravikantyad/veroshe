{% extends 'core/base.html' %}
{% load static %}

{% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 bg-light vh-100 p-4">
      <h5 class="mb-4">Main Menu</h5>
      <ul class="nav flex-column">
        <li class="nav-item"><a href="{% url 'seller_dashboard' %}" class="nav-link">Dashboard</a></li>
        <li class="nav-item"><a href="{% url 'manage_ads' %}" class="nav-link">Manage Listings</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Add New Listing</a></li>
        <li class="nav-item"><a href="#" class="nav-link">My Chats</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Analytics</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Subscription & Billing</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Profile Settings</a></li>
        <li class="nav-item"><a href="{% url 'logout' %}" class="nav-link text-danger">Logout</a></li>
      </ul>
    </div>
    
    <!-- Main Content -->
    <div class="col-md-9 col-lg-10 p-4">
      <div class="container mx-auto p-4">
        <div class="d-flex justify-between align-items-center">
        <!-- Heading -->
          <h2 class="text-2xl font-semibold mb-4">Manage Listings</h2>
          <form method="get" action="" class="flex items-center mb-4 space-x-2">
            <input type="text" name="search" placeholder="Search ads" class="border rounded-md px-3 py-1 text-sm focus:outline-none focus:ring focus:border-blue-300" value="{{ request.GET.search }}">
            <button type="submit" class="border border-gray-300 text-sm px-3 py-1 rounded-md hover:bg-gray-100">Search</button>
          </form>
        </div>
        <!-- Filter Tabs -->
        <div class="flex space-x-4 mb-6 border-b pb-2">
          <a href="?filter=all" class="{% if filter_by == 'all' %}border-b-2 border-blue-600 text-blue-600{% else %}text-gray-600{% endif %} hover:text-blue-600">
            All
          </a>  
          <a href="?filter=published" class="{% if filter_by == 'published' %}border-b-2 border-blue-600 text-blue-600{% else %}text-gray-600{% endif %} hover:text-blue-600">  
            Published  
          </a>  
          <a href="?filter=expired" class="{% if filter_by == 'expired' %}border-b-2 border-blue-600 text-blue-600{% else %}text-gray-600{% endif %} hover:text-blue-600">  
            Expired  
          </a>  
        </div>    <!-- Ads Grid -->    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">  
          {% for ad in ads %}  
          <div class="bg-white border rounded-lg shadow-sm p-4 relative">  
            <!-- 3-dots menu -->  
            <div class="absolute top-3 right-3 group">  
              <!-- 3 Dots button -->  
              <button onclick="toggleDropdown('dropdown-{{ ad.id }}')" class="text-gray-500 hover:text-gray-800 focus:outline-none">  
              &#x22EE;  
              </button>  <!-- Dropdown -->  
          <div id="dropdown-{{ ad.id }}" class="hidden absolute right-0 mt-2 w-48 bg-white border rounded-md shadow-lg z-50">  
            <a href="{% url 'edit_ad' ad.id %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Modify Ad</a>  
            {% if ad.is_expired %}  
              <a href="{% url 'mark_ad_active' ad.id %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Mark as Active</a>  
            {% else %}  
              <a href="{% url 'mark_ad_expired' ad.id %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Mark as Expired</a>  
            {% endif %}  
            <a href="{% url 'delete_ad' ad.id %}" class="block px-4 py-2 text-red-600 hover:bg-gray-100">Delete Ad</a>  
          </div>  
          </div>  

        <!-- Ad Info -->  
        <h3 class="text-lg font-semibold mb-1">{{ ad.title }}</h3>  
        <p class="text-sm text-gray-500 mb-1">Category: {{ ad.category }}</p>  
        <p class="text-sm text-gray-600 mb-1">Price: â‚¹{{ ad.price }}</p>  
        <p class="text-sm text-gray-500">Views: --</p>  
        <p class="text-sm mt-2">  
          Status:  
          {% if ad.is_expired %}  
            <span class="text-red-600 font-medium">Expired</span>  
          {% elif ad.is_active %}  
            <span class="text-green-600 font-medium">Published</span>  
          {% else %}  
            <span class="text-gray-600 font-medium">Unpublished</span>  
          {% endif %}  
        </p>  
      </div>  
      {% empty %}  
      <p class="text-gray-500 col-span-full">No ads found in this category.</p>  
      {% endfor %}
    
        </div>  </div>  <!-- Optional: Tailwind CDN -->  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">  <script>  
        function toggleDropdown(id) {  
          const dropdown = document.getElementById(id);  
          const allDropdowns = document.querySelectorAll('[id^="dropdown-"]');  
            
          allDropdowns.forEach(el => {  
            if (el.id !== id) {  
              el.classList.add('hidden');  
            }  
          });  
        
          dropdown.classList.toggle('hidden');  
        }  
      
        // Optional: Close dropdown on outside click  
        document.addEventListener('click', function (e) {  
          const allDropdowns = document.querySelectorAll('[id^="dropdown-"]');  
          allDropdowns.forEach(dropdown => {  
            if (!dropdown.contains(e.target) && !dropdown.previousElementSibling.contains(e.target)) {  
              dropdown.classList.add('hidden');  
            }  
          });  
        });  
      </script>
    </div>
  </div>
</div>
  
{% endblock %}



