{% extends 'core/base.html' %}
{% load widget_tweaks %}
{% load static %}


{% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 bg-light vh-100 p-4">
      <h5 class="mb-4">Main Menu</h5>
      <ul class="nav flex-column">
        <li class="nav-item"><a href="{% url 'seller_dashboard' %}" class="nav-link">Dashboard</a></li>
        <li class="nav-item"><a href="{% url 'manage_ads' %}" class="nav-link">Manage Listings</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Add New Listing</a></li>
        <li class="nav-item"><a href="#" class="nav-link">My Chats</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Analytics</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Subscription & Billing</a></li>
        <li class="nav-item"><a href="{% url 'profile_settings' %}" class="nav-link">Profile Settings</a></li>
        <li class="nav-item"><a href="{% url 'logout' %}" class="nav-link text-danger">Logout</a></li>
      </ul>
    </div>

    <!-- Main content -->
    <div class="col-md-9 col-lg-10 p-4">
      <div class="container mx-auto p-4">
        <div class="d-flex justify-between align-items-center">
          <h2 class="text-2xl font-bold mb-3">Profile Settings</h2>
        </div>

  <!-- Nav Tabs -->
        {% include 'core/tabs.html'  %}

      <!-- Profile Update Form -->
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
    
            <div class ="row align-items-center mb-4">
              <div class ="col-md-8">
                <h5 class="mb-3 font-semibold">Personal Information</h5>
                <p class="text-muted mb-1">Update your personal details to keep your profile current.</p>
              </div>

              <div class="row g-2 mb-4">
                <div class="col-md-12"><!-- Current Profile Picture -->
                  {% if user.profile.profile_picture %}
                    <img src="{{ user.profile.profile_picture.url }}" 
                         alt="Profile Picture" 
                         class="rounded-circle img-fluid" 
                         style="width: 80px; height: 80px; object-fit: cover;">
                  {% else %}
                    <img src="{% static 'images/profile-l.png' %}" 
                         alt="Default Avatar" 
                         class="rounded-circle img-fluid" 
                         style="width: 80px; height: 80px; object-fit: cover;">
                  {% endif %}
            
                  <!-- Change Profile Picture Link -->
                  <div class="mt-2">
                    <a href="{% url 'edit_profile_picture' %}" class="btn btn-outline-primary btn-sm">
                      Change Profile Picture
                    </a>
                  </div>
                </div>

      
                <div class="col-md-6 md-3">
                  <label class="form-label">{{ profile_form.full_name.label }}</label>
                  {{ profile_form.full_name|add_class:"form-control" }}
                </div>
    
                <div class="col-md-6">
                  <label class="form-label">{{ user_form.email.label }}</label>
                  {{ user_form.email|add_class:"form-control" }}
                </div>

                <div class="col-md-6">
                  <label class="form-label">{{ profile_form.phone_number.label }}</label>
                  {{ profile_form.phone_number|add_class:"form-control"|attr:"id:phone" }}
                  <label class="mt-1 d-block">
                      <input type="checkbox" id="maskToggle" /> Mask Number
                  </label>
                </div>

      

              <h6 class ="mb-3"> Address Information</h6>
              <div class ="row g-1">
                <div class="col-md-6">
                  <label class="form-label">{{ profile_form.street_name.label }}</label>
                  {{ profile_form.street_name|add_class:"form-control" }}
                </div>

                <div class="col-md-4">
                  <label class="form-label">{{ profile_form.city.label }}</label>
                  {{ profile_form.city|add_class:"form-control" }}
                </div>

                <div class="col-md-4">
                  <label class="form-label">{{ profile_form.state.label }}</label>
                  {{ profile_form.state|add_class:"form-control" }}
                </div>
    
                <div class="col-md-4">
                  <label class="form-label">{{ profile_form.pincode.label }}</label>
                  {{ profile_form.pincode|add_class:"form-control" }}
                </div>
    
                <div class="col-md-6">
                  <label class="form-label">{{ profile_form.country.label }}</label>
                  {{ profile_form.country|add_class:"form-control" }}
                </div>
    
              <div class="col-12 text-end">
                <button type="submit" class="btn btn-primary">Save Changes</button>
              </div>
            </div>
          </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const phoneInput = document.getElementById("phone");
    const maskToggle = document.getElementById("maskToggle");
    const fullNumber = "{{ profile_form.phone_number }}"; // original number from template

    maskToggle.addEventListener("change", () => {
        if (maskToggle.checked) {
            // Mask all digits except last 4
            const last4 = fullNumber.slice(-4);
            const masked = fullNumber.slice(0, -4).replace(/\d/g, "X") + last4;
            phoneInput.value = masked;
        } else {
            phoneInput.value = fullNumber; // restore original number
        }
    });
});
</script>

{% endblock %}